<!DOCTYPE html>
<html>
  <head>
    <title>Events Management - Bookings</title>

    <!-- Viewport mobile tag for sensible mobile support -->
    <!-- meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--STYLES-->
    <link rel="stylesheet" href="/styles/angular-deckgrid.css">
    <link rel="stylesheet" href="/styles/angular-toastr.css">
    <link rel="stylesheet" href="/styles/bootstrap.3.1.1.css">
    <link rel="stylesheet" href="/styles/events.css">
    <link rel="stylesheet" href="/styles/forMobileIE.css">
    <link rel="stylesheet" href="/styles/importer.css">
    <link rel="stylesheet" href="/styles/ng-dialog/myth/ngDialog-theme-default.css">
    <link rel="stylesheet" href="/styles/ng-dialog/myth/ngDialog-theme-plain.css">
    <link rel="stylesheet" href="/styles/ng-dialog/myth/ngDialog.css">
    <link rel="stylesheet" href="/styles/ng-dialog/ngDialog-custom-width.css">
    <link rel="stylesheet" href="/styles/ng-dialog/ngDialog-theme-default.min.css">
    <link rel="stylesheet" href="/styles/ng-dialog/ngDialog-theme-plain.min.css">
    <link rel="stylesheet" href="/styles/ng-dialog/ngDialog.min.css">
    <!--STYLES END-->

    <!--Added this so the client has access to the csrf tag and it's grabbed first service side on every page -->
    <script type="text/javascript">
    window.SAILS_LOCALS = {
      _csrf: "<%= _csrf %>",
       user: <%- JSON.stringify(res.locals.user) %>,
       event: <%- JSON.stringify(res.locals.event) %>,
       filter: "<%- filter %>",
       myBookings: <%- myBookings %>,
       eventBookings: <%- eventBookings %>,
    };
    
    </script>
    
  </head>

  <body ng-app="EventsModule" data-ng-controller="BookingsController" ng-cloak>

    <!-- container = Fixed-width container container-fluid = full-width -->
    <div class="container-fluid">
      <% include partials/private/navbar.ejs %>  
       
      <!--BOOKING FORM --> 
      <form ng-submit="filterBookings()" id="filter-form" name="filterform" 
          ng-class="{'form-signin':'<%- req.device.type %>'=='desktop'}">
        <h3 class="form-signin-heading"><span ng-show="myBookings">My </span><span ng-show="eventBookings">Event </span>Bookings <span ng-show="eventBookings">for {{event.name}}</span></h3>
        
        <div ng-show="eventBookings">
          <h4>{{ event.date | date : 'EEE, MMM dd, yyyy'}} at {{event.time}}</h4>
          <h4>{{event.venue}}<h4>
          <h5>Places remaining: {{event.capacity}}</h5>  
          <h5>Organiser: {{event.organiser.name}} (<a href="mailto:{{event.organiser.email}}" target="_top">{{event.organiser.email}}</a>)</h5>     
        </div>
        
        <div class="row">
  
          <!-- F I L T E R -->
           
          <div class="control-group form-group col-xs-12">
             
            <input type="text" class="form-control" placeholder="filter (hint: 'paid'/'unpaid'/'late' will work)" name="filter" ng-model="filterForm.filter" ng-change="filterChanged()">  
          </div>                    
         
        </div>
         
        <button class="btn btn-primary btn-lg btn-block" type="submit" ng-disabled="!filterform.filter.$dirty || filterForm.loading">
          <span ng-show="!filterForm.loading">Filter bookings</span>
          <span class="overlord-loading-spinner fa fa-spinner" ng-show="filterForm.loading" ></span>
          <span ng-show="filterForm.loading">Filtering...</span>
        </button>
        <button class="btn btn-primary btn-lg btn-block" type="button" ng-click="createNewBooking()" ng-disabled="newBooking" ng-show="eventBookings">
          <span ng-show="!newBooking">Create booking</span>
          <span class="overlord-loading-spinner fa fa-spinner" ng-show="newBooking" ></span>
          <span ng-show="newBooking">Please wait...</span>
        </button>
        <a class="btn-block" href="{{downloadUrl}}">
          <button class="btn btn-primary btn-lg btn-block" type="button">
             <span ng-show="!newBooking">Download bookings</span>
          </button>  
        </a>
        </br> 
           
  
        <input type="hidden" name="_csrf" value="<%= _csrf %>" />
      </form> 
        
      
       
      <h4 class="hidden-md hidden-lg">Tap a booking to edit</h4>  
      <h4 class="hidden-xs hidden-sm">Click a booking to edit</h4>  
            
      <% if (myBookings) {%> 
      <div deckgrid source="bookings" cardTemplate="/templates/myBookings.html" class="deckgrid"></div> 
      <% } %>
      <% if (eventBookings) {%> 
      <div deckgrid source="bookings" cardTemplate="/templates/eventBookings.html" class="deckgrid"></div> 
      <% } %>
     
    
      <% include partials/public/footer.ejs %>   

    </div>
    <!--SCRIPTS-->
    <script src="/js/dependencies/sails.io.js"></script>
    <script src="/js/dependencies/jquery/jquery.js"></script>
    <script src="/js/dependencies/angular.js"></script>
    <script src="/js/dependencies/angular-deckgrid.js"></script>
    <script src="/js/dependencies/angular-initial-value.min.js"></script>
    <script src="/js/dependencies/angular-toastr.js"></script>
    <script src="/js/dependencies/compareTo.module.js"></script>
    <script src="/js/dependencies/forMobileIE.js"></script>
    <script src="/js/dependencies/ngDialog.min.js"></script>
    <script src="/js/dependencies/ui-bootstrap-tpls-0.13.0.min.js"></script>
    <script src="/js/EventsModule.js"></script>
    <script src="/js/private/BookController.js"></script>
    <script src="/js/private/BookingsController.js"></script>
    <script src="/js/private/DashboardController.js"></script>
    <script src="/js/private/EventDetailsController.js"></script>
    <script src="/js/private/EventsController.js"></script>
    <script src="/js/private/ProfileController.js"></script>
    <script src="/js/private/UserDetailsController.js"></script>
    <script src="/js/private/UsersController.js"></script>
    <script src="/js/public/HomepageController.js"></script>
    <script src="/js/public/ResetController.js"></script>
    <script src="/js/public/SignupController.js"></script>
    <!--SCRIPTS END-->

  </body>
</html>
